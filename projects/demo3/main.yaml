# kate: indent-width 2;

# https://s3.cloudianhyperstore.com/downloads/HyperStore/7/7.1/CloudianHyperStore-7.1-CentOS-7.5-x86_64-Install.iso
# https://s3.cloudianhyperstore.com/downloads/HyperStore/7/7.1.1/CloudianHyperStore-7.1.1.bin

# BUG BUG BUG initially allow many different ways to specify the same thing,
# but at some point we will need to keep a small sub set that makes sense

cluster:
  # this will be used for many automatically generated pieces, keep it same as prokject
  name: demo3

  # you know these
  domain: demo3.cloudian.eu
  admin-endpoint: admin.demo3.cloudian.eu
  cmc-endpoint: cmc.demo3.cloudian.eu

  # ignored for the moment
  use-hsh: false
  root-password: x
  cmc-password: x

  # here you can add any public keys you might want. an installer key will be generated
  # remove the example key, or I'll have access to all you uclusters ]:-)
  ssh-authorized-keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDa0qBwFcY84k7dTkd4fX1De2QYGtY6aK6OCsEYH/gPSvHb59JvCsS7BnhrkSa7JK0vdv2h1/xbs1JajsMcNjdHrNwHlA+XPK9dPf4Op1HqTfAQzJxo+w1o1Ff5kXbRtyKb6ZWc3r2HjndIvIxN5t2NgGZ20oZji4CiB0MHEH2AjgUie1D25NQAg7QUF/D2en5PbAyovbA7q3VW6IFMQhAfhBtYcQO8xxdymrMCB+y3mZFsMs2BjpDtbFLiSAjwcy9mx5KIyDqA+k8qlV1ayuDX6WFQoxCGQ2S62+Du5TTE4TOP9kmoyM160IyboN/7lRb2oMeaho06tFGFtkqSSruX mdione@nimbus

  # TODO: allow g Gb GB GiB

  #########################
  # the layout for the disks.
  # LXC already presents the root partition based in the system's image,
  # so for the moment it can be absent and will be ignored anyways.
  disk-config:
  - name: ssd1
    type: raw
    size: 256  # in GiB

  - name: ssd2
    # ditto: true   :-P
    type: raw
    size: 256  # in GiB

  - name: root
    type: raid1  # mirror
    block-devs: [ ssd1, ssd2 ]
    # TODO: maybe size here could imply the slaves' sizes
    fs: ext4
    mount-point: /

  # these are the data drives, there will be 4 of them
  - name: data
    type: raw
    # LXC does not provide disk images, but volumes. fs and size are ignored
    # and all data disks share the same partition (the one holdinh the storage pool)
    fs: ext4
    size: 4096
    count: 4
    mount-point: /cloudian  # %d -> /cloudian1

  #########################
  # interface definitions
  # in the future we will support bonding and vlans, altho they will be faked

  # network-config can be defined at cluster, region, dc or node level
  # if defined at several levels, they're merged,
  # with more specific definitions overwriting more general ones
  network-config:
  - name:   eth0
    type:   eth
    # the IP prefix
    prefix: 24
    # remember the use parameter in the infra's switch?
    # this is how we connect virtual interfaces to the infra
    # the names are kinda arbitrary, but frontend, backend and management are special
    use:    frontend

  - name:   eth1
    type:   eth
    prefix: 24
    use:    backend

  - name:   ipmi
    type:   ipmi  # TODO: for the moment this is ignored
    prefix: 24
    use:    management  # TODO: this could be implied from name


  #########################
  # this defines the parameters for the node's resources, other types of infra elements have their own
  # TODO: move to ams.yaml?
  container-config:  # this is currently processed by terraform, but I'll try to keep it as generic as possible
    cpus: 4
    memory: 8  # in GiB


  #########################
  # now more HyperStore parameters
  # regions -> DCs -> hosts
  regions:
  - name: eu-1
    default: true
    # we do a per-region NTP because we want to prioritize syncing time across the entire region
    # instead of each data-center.
    ntp-servers:
    - 0.centos.pool.ntp.org
    - 1.centos.pool.ntp.org
    - 2.centos.pool.ntp.org
    - 3.centos.pool.ntp.org

    # these are not ssumed to be based on the region name, you have to provide them
    s3-endpoints:
    - s3-eu-1.demo3.cloudian.eu

    website-endpoint: s3-website-eu-1.demo3.cloudian.eu

    #######################
    data-centers:
    - name: DC10
      container-config:
        # this defines which LXD host will hold this DC. please modify
        host: nimbus

      #####################
      nodes:
      - name: demo3-node1
        installer-node: true
        # here you assign IPs to the interfaces based on their use.
        frontend:   10.254.254.231
        backend:    10.230.230.1

      - name: demo3-node2
        frontend:   10.254.254.232
        backend:    10.230.230.2

      - name: demo3-node3
        frontend:   10.254.254.233
        backend:    10.230.230.3
