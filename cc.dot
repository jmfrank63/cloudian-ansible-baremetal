digraph G {
    node [ shape=box, style=filled ];

    "main.yaml" -> { "cluster.yaml" "virt.yaml" } [ label = "split.py" ]

    "cluster.yaml" -> { "inventory.yaml" "survey.csv" "preseed.conf" "ansible.iso" }[ label = "cluster2cab.py" ]
    "inventory.yaml" -> "ansible.iso" [ label = "build-iso.sh" ]

    { "virt.yaml" "infra.yaml" } -> "main.tf" [ label = "virt2tf.py" ]
    "main.tf" -> { "lxd" "terraform.tfstate" } [ label = "terraform" ]
    { "inventory.yaml" "terraform.tfstate" } -> "inventory-fixed.yaml" [ label = "tf2cluster.py" ]
    "main.tf" -> { "authorized_keys" "provision iface config" "fix pam" "locale" "timezone" } [ label = "cloud-init" ]
    { "inventory-fixed.yaml" "survey.csv" } -> "hs" [ label = "ansible" ]
    "lxd" -> "lxc"
    "lxc" -> "namespaces"
    "namespaces" -> "hs"

    "stack" [ shape=record, rankdir="TB", label = "{cluster|network|infra}" ]
}
